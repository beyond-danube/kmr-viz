<!DOCTYPE html>
<html>
<head>
    <title>–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ—ñ–º–µ–Ω–Ω–∏—Ö –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –ö–∏—ó–≤—Ä–∞–¥–∏</title>

    <meta name="description" content="">
    <meta name="robots" content="noindex, nofollow">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <!-- <script src="js/config.js"></script> -->

    <link rel="stylesheet" href="css/style.css">

    <!-- <script src="js/drawing-constants.js"></script> -->
    <script type="text/javascript"  src="js/data-getter.js"></script>
    <script type="text/javascript" src="js/chart-drawers.js"></script>
    <script type="text/javascript" src="js/drawing-constants.js"></script>
    <script type="text/javascript" src="js/table-drawer.js"></script>

    <!-- <link rel="stylesheet" href="css/main.css"> -->


    <!-- <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;800&display=swap" rel="stylesheet"> -->

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>–ß–∏–º –∑–∞–π–º–∞—î—Ç—å—Å—è –ö–∏—ó–≤—Ä–∞–¥–∞</h1>
                <p>–ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∞–Ω–∏—Ö —â–æ–¥–æ <a href="https://kmr.gov.ua/uk/result_golosuvanya">–ø–æ—ñ–º–µ–Ω–∏—Ö –≥–æ–ª–æ—Å—É–≤–∞–Ω—å</a></p>
                <p>
                    ‚Äî –©–æ —Ü–µ –∑–∞ –≥—Ä–∞—Ñ—ñ–∫–∏ —Ç–∞ –∑–≤—ñ–¥–∫–∏ –¥–∞–Ω—ñ?<br>
                    ‚Äî –ì—Ä–∞—Ñ—ñ–∫–∏ ‚Äî —Ü–µ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –ö–∏—ó–≤—Ä–∞–¥–∏, –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∞–Ω–∏—Ö<br>
                    ‚Äî –î—É–∂–µ —Å–∫–ª–∞–¥–Ω–∞ –¥—ñ–∞–≥—Ä–∞–º–∞, —è–∫ —ó—ó —á–∏—Ç–∞—Ç–∏?<br>
                    ‚Äî –ú–∏ –∑–≥—Ä—É–ø—É–≤–∞–ª–∏ –¥–∞–Ω—ñ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, –ì—Ä—É–ø–∞ ‚Üí –¢–µ–º–∞ ‚Üí –ì–æ–ª–æ—Å ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç<br>
                    ‚Äî –©–æ –∑–Ω–∞—á–∏—Ç—å —à–∏—Ä–∏–Ω–∞ –ª—ñ–Ω—ñ–π?<br>
                    ‚Äî –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–µ–º —É –≥—Ä—É–ø—ñ –∞–±–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤<br>
                </p>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div  id="docs-loaded-progress-bar-div" style="position: relative; top: 50%;">
                    <p class="lead">–ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ä—ñ—à–µ–Ω–Ω—è –∑–∞ –ø–µ—Ä—ñ–æ–¥</p>
                        <div class="progress">
                        <div class="progress-bar" id="docs-loaded-progress-bar" role="progressbar" style="width: 0%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div id="sankey_voting" style="height: 70vh; position: relative;">
                </div>                
            </div>
        </div>
    </div>
    <div class="container mt-3">
        <!-- <div class="row mb-4">
            <div class="col-2">
                <select id="year" class="form-select">
                  <option selected>2021</option>
                  <option>2022</option>
                </select>
            </div>
            <div class="col-2">
                <select id="month" class="form-select">
                  <option>01</option>
                  <option selected>02</option>
                  <option>03</option>
                  <option>04</option>
                  <option>05</option>
                  <option>06</option>
                  <option>07</option>
                  <option>08</option>
                  <option>09</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                </select>
            </div>
            <div class="col-2">
                <button type="button" class="btn btn-primary" id="submit">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
            </div>
        </div> -->
        <div class="row mb-4">
            <div class="col-2">
                <select id="year-from" class="form-select">
                  <option selected>2021</option>
                  <option>2022</option>
                </select>
            </div>
            <div class="col-2">
                <select id="month-from" class="form-select">
                  <option>01</option>
                  <option selected>02</option>
                  <option>03</option>
                  <option>04</option>
                  <option>05</option>
                  <option>06</option>
                  <option>07</option>
                  <option>08</option>
                  <option>09</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                </select>
            </div>
            <div class="col-1">
            </div>
            <div class="col-2">
                <select id="year-to" class="form-select">
                  <option selected>2021</option>
                  <option>2022</option>
                </select>
            </div>
            <div class="col-2">
                <select id="month-to" class="form-select">
                  <option>01</option>
                  <option selected>02</option>
                  <option>03</option>
                  <option>04</option>
                  <option>05</option>
                  <option>06</option>
                  <option>07</option>
                  <option>08</option>
                  <option>09</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                </select>
            </div>
            <div class="col-2">
                <button type="button" class="btn btn-primary" id="submit">–ü–æ–∫–∞–∑–∞—Ç–∏</button>
            </div>
        </div>
        <div class="row row mb-4">
            <div class="col">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="hideTechWorkCheckbox">
                    <label class="form-check-label" for="hideTechWorkCheckbox">–ù–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É —Ä–æ–±–æ—Ç—É</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <p>
                    ‚Äî –ù–∞–≤—ñ—â–æ —Ü–µ–π –∞–Ω–∞–ª—ñ–∑? –¶–µ –ø—Ä–æ –∑—Ä–∞–¥—É?<br>
                    ‚Äî –ù—ñ, –Ω–∞–≤–ø–∞–∫–∏. –ú–∏ —Ä–∞–¥—ñ, —â–æ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –¥–∞–Ω—ñ –Ω–∞—Ä–µ—à—Ç—ñ —î —ñ –º–∏ –º–æ–∂–µ–º–æ –Ω–∞—á–æ–Ω–æ –ø–æ–±–∞—á–∏—Ç–∏ —á–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∑–∞–π–º–∞—î—é—Ç—å—Å—è –º—ñ—Å—å–∫—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏<br>
                    ‚Äî –Ø–∫—ñ –≤–∞—à—ñ –≤–∏—Å–Ω–æ–≤–∫–∏?<br>
                    ‚Äî –ó–∞–≥–∞–ª—å–Ω–∏–π ‚Äî —ñ–Ω—Å—Ç–∏—Ç—É—Ü—ñ—è –ö–∏—ó–≤—Ä–∞–¥–∏ –≤ –Ω–∏–Ω—ñ—à–Ω—å–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ –Ω–µ –º–∞—î —Å–µ–Ω—Å—É<br>
                    ‚Äî –ß–æ–º—É –≤–∏ —Ç–∞–∫ –≤–≤–∞–∂–∞—î—Ç–µ?<br>
                    ‚Äî –ë—ñ–ª—å—à—ñ—Å—Ç—å —Ç–µ–º –≥–æ–ª–æ—Å—É–≤–∞–Ω—å —Ü–µ —Ç–µ–º–∏ –ø—Ä–æ –∑–µ–º–µ–ª—å–Ω—ñ –¥—ñ–ª—è–Ω–∫–∏, –∫–æ–º—É —â–æ –≤—ñ–¥–¥–∞—Ç–∏ –≤ –ø–æ—Å—Ç—ñ–π–Ω–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è, –∞–±–æ –≤ –∞—Ä–µ–Ω–¥—É. –ù–∞—Ç–æ–º—ñ—Å—Ç—å –º—ñ—Å—å–∫—ñ –ø—Ä–æ—î–∫—Ç–∏, —Ç–∞–∫—ñ —è–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–±—É–¥–æ–≤–∏ –∑ –≥—Ä–æ–º–∞–¥—Å—å–∫—ñ—Å—Ç—é, —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ —Ç–∞ –º—ñ—Å—å–∫—ñ —Ç–µ–º–∏ –º–∞–π–∂–µ –Ω–µ —Ñ—ñ–≥—É—Ä—É—é—Ç—å —É –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è—Ö<br>
                    ‚Äî –ó–º–æ–∂–µ—Ç–µ —Ä–æ–∑–ø–æ–≤—ñ—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ?<br>
                    ‚Äî –¢–∞–∫, –Ω–∏–∂—á–µ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ç–∞ –∞–Ω–∞–ª—ñ–∑<br>
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <h2>–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–æ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ—à–µ–Ω–Ω—è</h1></div>
                <p>
                    –í—Å–µ, —â–æ –≤–∏–Ω–µ—Å–µ–Ω–µ –Ω–∞ –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è, –º–∞–π–∂–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–∞—î –≥–æ–ª–æ—Å—ñ–≤ –ü—Ä–æ—Ç–∏<br>
                    –ù–µ–ø—Ä–∏–π–Ω—è—Ç–∏—ñ —Ä—ñ—à–µ–Ω–Ω—è –Ω–µ–ø—Ä–∏–π–Ω—è—Ç—ñ –Ω–µ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ —á–∞—Å—Ç–∏–Ω–∞ –¥–µ–ø—É—Ç–∞—Ç—ñ–≤ –ö–∏—ó–≤—Ä–∞–¥–∏ –ø—Ä–æ—Ç–∏, –∞ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ —Ö—Ç–æ—Å—å —É—Ç—Ä–∏–º–∞–≤—Å—è, –Ω–µ –≥–æ–ª–æ—Å—É–≤–∞–≤, –∞–±–æ –Ω–µ –ø—Ä–∏–π—à–æ–≤
                </p>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <h5>–ü—Ä–∏–π–Ω—è—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è</h5>
                <div id="results-category-yes" class="pie-chart"></div>
            </div>
            <div class="col-lg-6">
                <h5>–ù–µ –ø—Ä–∏–π–Ω—è—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è</h5>
                <div id="results-category-no" class="pie-chart"></div>
            </div>
            <div class="col-lg-6">
                <h5>–í—Å—å–æ–≥–æ –≥–æ–ª–æ—Å—ñ–≤</h5>
                <div id="votes-distributon" class="pie-chart"></div>
            </div>
            <div class="col-lg-6">
                <h5>–†—ñ—à–µ–Ω–Ω—è –∑–∞ –ø–µ—Ä—ñ–æ–¥</h5>
                <div id="results-distributon" class="pie-chart"></div>
            </div>
        </div>
    </div>
    <div class="container">
        <h1>–í—Å—ñ —Ä—ñ—à–µ–Ω–Ω—è —Å–ø–∏—Å–∫–æ–º</h1>
        <p>
            üôã‚Äç‚ôÇÔ∏è –ó–∞<br>
            üôÖ‚Äç‚ôÄÔ∏è –ü—Ä–æ—Ç–∏<br>
            ü§∑ –£—Ç—Ä–∏–º–∞–≤—Å—è<br>
            üë§ –ù–µ –≥–æ–ª–æ—Å—É–≤–∞–≤<br>
            ü•∑ –í—ñ–¥—Å—É—Ç–Ω—ñ–π<br>
            üìë –†—ñ—à–µ–Ω–Ω—è
        </p>
    </div>
    <div class="container-fluid" id="details-tables">
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

    <script>

        let selectedYear = document.getElementById("year")
        let selectedMonth = document.getElementById("month")

        let selectedYearFrom = document.getElementById("year-from")
        let selectedMonthFrom = document.getElementById("month-from")

        let selectedYearTo = document.getElementById("year-to")
        let selectedMonthTo = document.getElementById("month-to")

        let submitButton = document.getElementById("submit")

        let chart = document.getElementById("sankey_voting")

        let barContainer = document.getElementById("docs-loaded-progress-bar-div")
        let bar = document.getElementById("docs-loaded-progress-bar")

        let dataFiles

        let votesByCategory

        let datarows

        let loadedDocs = { current: 0, total: 0 }

        let checkbox = document.getElementById("hideTechWorkCheckbox")

        function drawLoadProgress() {
            if(loadedDocs.current < loadedDocs.total) {
                bar.style.width = `${loadedDocs.current/loadedDocs.total*100}%`
                bar.innerText = `${loadedDocs.current}/${loadedDocs.total}`
            }

            setTimeout("drawLoadProgress()", 300);
        }

        // TODO: make it less tricky
        async function getDataForChartRange() {

            barContainer.hidden = false
            chart.innerHTML = ''

            loadedDocs.current = 0

            datarows = []

            let dataFilesToGet = []

            if(selectedYearFrom.value == selectedYearTo.value) {

                let values = dataFiles[selectedYearFrom.value]

                for (const month in values) {
                    if ((parseInt(month) >= parseInt(selectedMonthFrom.value)) && (parseInt(month) <= parseInt(selectedMonthTo.value))) {
                        values[month].forEach(document => dataFilesToGet.push(document))               
                    }
                }
            } else {
                for (const year in dataFiles) {
                    // if (parseInt(year) == parseInt(selectedYearFrom.value)) {
                    //     dataFiles[year].forEach(month => {
                    //         if(parseInt(month) >= selectedMonthFrom) {
                    //             dataFiles[year][month].forEach(document => dataFilesToGet.push(document))
                    //         }
                    //     })
                    // }

                    if (parseInt(year) == parseInt(selectedYearFrom.value)) {
                        for (const month in dataFiles[year]) {
                            if(parseInt(month) >= selectedMonthFrom.value) {
                                dataFiles[year][month].forEach(document => dataFilesToGet.push(document))
                            }
                        }
                    }
                    else if (parseInt(year) == parseInt(selectedYearTo.value)) {
                        for (const month in dataFiles[year]) {
                            if(parseInt(month) <= selectedMonthTo.value) {
                                dataFiles[year][month].forEach(document => dataFilesToGet.push(document))
                            }
                        }
                    }
                    else {
                        for (const month in dataFiles[year]) {
                            dataFiles[year][month].forEach(document => dataFilesToGet.push(document))
                        }                    
                    }
                }
            }

            loadedDocs.total = dataFilesToGet.length

            drawLoadProgress()

            for (const document of dataFilesToGet) {
                await getDataFile(document).then(res => datarows.push(res)).then(() => loadedDocs.current++) 
            }

            barContainer.hidden = true
        }

        async function getDataForChart() {

            barContainer.hidden = false
            chart.innerHTML = ''

            loadedDocs.current = 0

            datarows = []

            loadedDocs.total = dataFiles[selectedYear.value][selectedMonth.value].length

            drawLoadProgress()

            for (const document of dataFiles[selectedYear.value][selectedMonth.value]) {
                await getDataFile(document).then(res => datarows.push(res)).then(() => loadedDocs.current++) 
            }

            barContainer.hidden = true
        }

        window.addEventListener('load', async () => { 
            dataFiles = await getDateMap()
            await getDataForChartRange()

            votesByCategory = getVotingResultsByCategory(datarows)
            drawChart(votesByCategory)

            console.log(votesByCategory)

            drawVotePieChart(datarows, "votes-distributon")
            drawResultPieChart(datarows, "results-distributon")
            drawThemeDecision(votesByCategory, "results-category-yes", resultOptions.YES)
            drawThemeDecision(votesByCategory, "results-category-no", resultOptions.NO)

            createThemeTables(votesByCategory)
        })

        submitButton.addEventListener('click', async () => {
            await getDataForChartRange()

            votesByCategory = getVotingResultsByCategory(datarows)

            if(checkbox.checked) {
                themeToCategoryMap.ORG.forEach(categoty => {
                    if(votesByCategory.hasOwnProperty(categoty)) {
                        delete votesByCategory[categoty]
                    }
                })
            }

            drawChart(votesByCategory)

            console.log(votesByCategory)

            drawVotePieChart(datarows, "votes-distributon")
            drawResultPieChart(datarows, "results-distributon")
            drawThemeDecision(votesByCategory, "results-category-yes", resultOptions.YES)
            drawThemeDecision(votesByCategory, "results-category-no", resultOptions.NO)

            let tables = document.getElementById("details-tables")
            tables.innerHTML = ''

            createThemeTables(votesByCategory)
        })
        

    </script>
</body>

</html>
